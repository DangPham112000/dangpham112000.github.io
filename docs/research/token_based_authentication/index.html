<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  Token-based authentication
  #


Senario: Each time a user accesses your website containing sensitive resources, such as posting a new blog, they are required to log in repeatedly every time they visit
Problem: Is there a way to allow them to log in just once and avoid re-logging in, even if their previous session was two days ago?
Solution: Access tokens were designed to solve this problem


  Access token
  #


Provide a one-time login for users
Reduce database access for password verification, user information retrieval, and role checking


  Characteristics
  #


Short-lived
Stored in client-side storage
Contains the user&rsquo;s identity
Contains a set of claims, permissions, or roles of the user
Grants access to the system


  Cons
  #

If we only use AT for authentication
So when hacker stolen AT successfully, they can impersonate the user">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://dangpham112000.github.io/docs/research/token_based_authentication/">
  <meta property="og:site_name" content="Dante 0401">
  <meta property="og:title" content="Token-based Authentication">
  <meta property="og:description" content="Token-based authentication # Senario: Each time a user accesses your website containing sensitive resources, such as posting a new blog, they are required to log in repeatedly every time they visit Problem: Is there a way to allow them to log in just once and avoid re-logging in, even if their previous session was two days ago? Solution: Access tokens were designed to solve this problem Access token # Provide a one-time login for users Reduce database access for password verification, user information retrieval, and role checking Characteristics # Short-lived Stored in client-side storage Contains the user‚Äôs identity Contains a set of claims, permissions, or roles of the user Grants access to the system Cons # If we only use AT for authentication So when hacker stolen AT successfully, they can impersonate the user">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
    <meta property="article:published_time" content="2025-01-03T01:47:46+07:00">
    <meta property="article:modified_time" content="2025-01-03T01:47:46+07:00">
<title>Token-based Authentication | Dante 0401</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" >
<link rel="canonical" href="https://dangpham112000.github.io/docs/research/token_based_authentication/">
<link rel="stylesheet" href="/book.min.ef1786281083252320100bd5f394f36844d3252afdbd5bfe72e5f440aaff402b.css" integrity="sha256-7xeGKBCDJSMgEAvV85TzaETTJSr9vVv&#43;cuX0QKr/QCs=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.97ac8f2437060dbdc99a9a92cdabf8ea4cc952cf0b98986f75050e307ca224be.js" integrity="sha256-l6yPJDcGDb3JmpqSzav46kzJUs8LmJhvdQUOMHyiJL4=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Dante 0401</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>












  



  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>RESEARCH</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/research/process_vs_thread/" class="">Process vs Thread</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/chrome_architecture/" class="">Chrome Architecture</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/aws_overview/" class="">AWS Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/be_protocol/" class="">Backend Protocol</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/research/be_protocol/tcp_udp/" class="">TCP - UDP - Draft</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/be_protocol/http/" class="">HTTP - Draft</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/be_protocol/tls_ssl/" class="">TLS - SSL - Draft</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/be_protocol/https/" class="">HTTPS - Draft</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/be_protocol/webrtc/" class="">WebRTC - Draft</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/be_protocol/websocket/" class="">Websocket - Draft</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/be_protocol/grpc/" class="">gRPC - Draft</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/be_protocol/communication/" class="">Communication - Draft</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/encryption/" class="">Encryption - Draft</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/token_based_authentication/" class="active">Token-based Authentication</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/event_loop/" class="">Event loop - Draft</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/security/" class="">Security - Draft</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/research/security/cors/" class="">CORS - draft</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/security/xss/" class="">XSS - Draft</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/security/csrf/" class="">CSRF - Draft</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/security/packet_sniffing/" class="">Packet Sniffing - Draft</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/security/evil_twin/" class="">Evil Twin - Draft</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/security/arp_spoofing/" class="">ARP Spoofing - Draft</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/security/dns_poisoning/" class="">DNS Poisoning - Draft</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/security/hsts/" class="">HSTS - Draft</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/research/scale/" class="">Scale - draft</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>TIPS</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/tips/001_unit_test/" class="">Unit Test</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tips/002_git/" class="">Git</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tips/003_docker/" class="">Docker</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tips/004_ops/" class="">Ops</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tips/005_passion/" class="">Spark Passion</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>PROBLEMS</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/problems/knight_dialer/" class="">Knight Dialer</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/problems/design_hashmap/" class="">Design HashMap - Draft</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Token-based Authentication</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#access-token">Access token</a>
      <ul>
        <li><a href="#characteristics">Characteristics</a></li>
      </ul>
    </li>
    <li><a href="#refresh-token">Refresh token</a>
      <ul>
        <li><a href="#characteristics-1">Characteristics</a></li>
      </ul>
    </li>
    <li><a href="#how-do-they-work-together">How do they work together?</a>
      <ul>
        <li><a href="#basic-flow">Basic flow</a></li>
        <li><a href="#token-expired">Token expired</a></li>
        <li><a href="#threat-mitigation-strategy">Threat mitigation strategy</a></li>
        <li><a href="#third-party-authen-concept">Third party authen concept</a></li>
      </ul>
    </li>
    <li><a href="#demo-code">Demo code</a></li>
    <li><a href="#reference">Reference</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="token-based-authentication">
  Token-based authentication
  <a class="anchor" href="#token-based-authentication">#</a>
</h1>
<ul>
<li><strong>Senario</strong>: Each time a user accesses your website containing <strong>sensitive</strong> resources, such as posting a new blog, they are required to log in <strong>repeatedly</strong> every time they visit</li>
<li><strong>Problem</strong>: Is there a way to allow them to log in just <strong>once</strong> and avoid re-logging in, even if their previous session was two days ago?</li>
<li><strong>Solution</strong>: Access tokens were designed to solve this problem</li>
</ul>
<h2 id="access-token">
  Access token
  <a class="anchor" href="#access-token">#</a>
</h2>
<ul>
<li>Provide a one-time login for users</li>
<li>Reduce database access for password verification, user information retrieval, and role checking</li>
</ul>
<h3 id="characteristics">
  Characteristics
  <a class="anchor" href="#characteristics">#</a>
</h3>
<ul>
<li>Short-lived</li>
<li>Stored in client-side storage</li>
<li>Contains the user&rsquo;s identity</li>
<li>Contains a set of claims, permissions, or roles of the user</li>
<li><strong>Grants access to the system</strong></li>
</ul>
<h4 id="cons">
  Cons
  <a class="anchor" href="#cons">#</a>
</h4>
<p>If we only use AT for authentication
So when hacker stolen AT successfully, they can impersonate the user</p>
<p>How about short-term AT?</p>
<ul>
<li>Each time we grant AT we need to force user re-login
&ndash;&gt; Bad UX</li>
</ul>
<p>How about combine short-term AT and store AT in DB?
Our server can grant several AT and somehow one of them be stolen by hacker, if we store current AT-list and used-AT list. Then if we renew an AT for hacker or user and then another try to renew a used AT we can clear all of them and then force user to re-login</p>
<ul>
<li>This approach is totally possible
&ndash;&gt; BUT we will increase the I/O cost in DB because too much AT used to check and store</li>
</ul>
<p>&ndash;&gt; So we design RT</p>
<h2 id="refresh-token">
  Refresh token
  <a class="anchor" href="#refresh-token">#</a>
</h2>
<p>In order to prevent hacker stolen AT, we decide AT only live in a short time
So refresh token born as a factor to re-grant AT when they are expired and user then can be continue their session with our resource without re-login and don&rsquo;t worry about impersonation</p>
<h3 id="characteristics-1">
  Characteristics
  <a class="anchor" href="#characteristics-1">#</a>
</h3>
<ul>
<li>Long-lived</li>
<li>Single-use</li>
<li>Stored on the server and the client</li>
<li><strong>Used to obtain a new pair of access and refresh tokens</strong></li>
</ul>
<h4 id="each-rt-can-only-be-used-once">
  Each RT can only be used once
  <a class="anchor" href="#each-rt-can-only-be-used-once">#</a>
</h4>
<p>Whenever we see the reused RT, we must right away clear all token and it&rsquo;s keys, then force user to re-login to the system</p>
<h2 id="how-do-they-work-together">
  How do they work together?
  <a class="anchor" href="#how-do-they-work-together">#</a>
</h2>
<h3 id="basic-flow">
  Basic flow
  <a class="anchor" href="#basic-flow">#</a>
</h3>
<p><img src="/research/token_based_authentication/basic_flow.png" alt="basic_flow" /></p>
<h3 id="token-expired">
  Token expired
  <a class="anchor" href="#token-expired">#</a>
</h3>
<p><img src="/research/token_based_authentication/token_expired.png" alt="token_expired" /></p>
<h3 id="threat-mitigation-strategy">
  Threat mitigation strategy
  <a class="anchor" href="#threat-mitigation-strategy">#</a>
</h3>
<p><img src="/research/token_based_authentication/threat_mitigation.png" alt="threat_mitigation" /></p>
<h3 id="third-party-authen-concept">
  Third party authen concept
  <a class="anchor" href="#third-party-authen-concept">#</a>
</h3>
<p><img src="/research/token_based_authentication/3rd_auth.png" alt="3rd_auth" /></p>
<h2 id="demo-code">
  Demo code
  <a class="anchor" href="#demo-code">#</a>
</h2>
<ul>
<li>This code is intended to give you insight into implementing token-based authentication; it is not my full authentication implementation</li>
<li>You can find my complete code implementation on <a href="https://github.com/DangPham112000/fakebut">GitHub</a></li>
</ul>
<p><strong>NodeJS</strong></p>
<details ><summary>authUtils.js</summary>
  <div class="markdown-inner">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">jwt</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;jsonwebtoken&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">crypto</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;crypto&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">genKeyPairRSA</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">privateKey</span>, <span style="color:#a6e22e">publicKey</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">crypto</span>.<span style="color:#a6e22e">generateKeyPairSync</span>(<span style="color:#e6db74">&#34;rsa&#34;</span>, {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">modulusLength</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">4096</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">publicKeyEncoding</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;pkcs1&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">format</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;pem&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">privateKeyEncoding</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;pkcs1&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">format</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;pem&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> { <span style="color:#a6e22e">privateKey</span>, <span style="color:#a6e22e">publicKey</span> };
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#a6e22e">error</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">createTokenPair</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">payload</span>, <span style="color:#a6e22e">publicKey</span>, <span style="color:#a6e22e">privateKey</span>) =&gt; {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">accessToken</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">jwt</span>.<span style="color:#a6e22e">sign</span>(<span style="color:#a6e22e">payload</span>, <span style="color:#a6e22e">privateKey</span>, {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">algorithm</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;RS256&#34;</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">expiresIn</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2 days&#34;</span>,
</span></span><span style="display:flex;"><span>		});
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">refreshToken</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">jwt</span>.<span style="color:#a6e22e">sign</span>(<span style="color:#a6e22e">payload</span>, <span style="color:#a6e22e">privateKey</span>, {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">algorithm</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;RS256&#34;</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">expiresIn</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;7 days&#34;</span>,
</span></span><span style="display:flex;"><span>		});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Just ensure the encryption is implemented correctly
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">jwt</span>.<span style="color:#a6e22e">verify</span>(<span style="color:#a6e22e">accessToken</span>, <span style="color:#a6e22e">publicKey</span>, (<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">decode</span>) =&gt; {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;error verify: &#34;</span>, <span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>			} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;decode verify: &#34;</span>, <span style="color:#a6e22e">decode</span>);
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> { <span style="color:#a6e22e">accessToken</span>, <span style="color:#a6e22e">refreshToken</span> };
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">throw</span> <span style="color:#a6e22e">error</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">authentication</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>) =&gt; {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">userId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">headers</span>[<span style="color:#a6e22e">HEADER</span>.<span style="color:#a6e22e">CLIENT_ID</span>];
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">userId</span>) <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">AuthFailureError</span>(<span style="color:#e6db74">&#34;Invalid request&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">keyStore</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">KeyTokenService</span>.<span style="color:#a6e22e">findByUserId</span>(<span style="color:#a6e22e">userId</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">keyStore</span>) <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">NotFoundError</span>(<span style="color:#e6db74">&#34;Not found keyStore&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">refreshToken</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">headers</span>[<span style="color:#a6e22e">HEADER</span>.<span style="color:#a6e22e">REFRESHTOKEN</span>];
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">refreshToken</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">decodeUser</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">jwt</span>.<span style="color:#a6e22e">verify</span>(<span style="color:#a6e22e">refreshToken</span>, <span style="color:#a6e22e">keyStore</span>.<span style="color:#a6e22e">publicKey</span>);
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">userId</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">decodeUser</span>.<span style="color:#a6e22e">userId</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">AuthFailureError</span>(<span style="color:#e6db74">&#34;Invalid userId&#34;</span>);
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">keyStore</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">keyStore</span>;
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">user</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">decodeUser</span>; <span style="color:#75715e">// {userId, email}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">refreshToken</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">refreshToken</span>;
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>		} <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">throw</span> <span style="color:#a6e22e">error</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">accessToken</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">headers</span>[<span style="color:#a6e22e">HEADER</span>.<span style="color:#a6e22e">AUTHORIZATION</span>];
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">accessToken</span>) <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">AuthFailureError</span>(<span style="color:#e6db74">&#34;Invalid request&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">decodeUser</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">jwt</span>.<span style="color:#a6e22e">verify</span>(<span style="color:#a6e22e">accessToken</span>, <span style="color:#a6e22e">keyStore</span>.<span style="color:#a6e22e">publicKey</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">userId</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">decodeUser</span>.<span style="color:#a6e22e">userId</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">AuthFailureError</span>(<span style="color:#e6db74">&#34;Invalid userId&#34;</span>);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">keyStore</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">keyStore</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">user</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">decodeUser</span>; <span style="color:#75715e">// {userId, email}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">throw</span> <span style="color:#a6e22e">error</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div>
  </div>
</details>

</br>
<details ><summary>access.service.js</summary>
  <div class="markdown-inner">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">bcrypt</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;bcrypt&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">KeyTokenService</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;./keyToken.service.js&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">createTokenPair</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">genKeyPairRSA</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">verifyJWT</span>,
</span></span><span style="display:flex;"><span>} <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;../auth/authUtils.js&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AccessService</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">login</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> ({ <span style="color:#a6e22e">email</span>, <span style="color:#a6e22e">password</span> }) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">foundUser</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">findByEmail</span>({ <span style="color:#a6e22e">email</span> });
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">foundUser</span>) <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">BadRequestError</span>(<span style="color:#e6db74">&#34;User not yet registered&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">match</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">bcrypt</span>.<span style="color:#a6e22e">compare</span>(<span style="color:#a6e22e">password</span>, <span style="color:#a6e22e">foundUser</span>.<span style="color:#a6e22e">password</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">match</span>) <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">AuthFailureError</span>(<span style="color:#e6db74">&#34;Authentication error&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">privateKey</span>, <span style="color:#a6e22e">publicKey</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">genKeyPairRSA</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">_id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">userId</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">foundUser</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tokens</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">createTokenPair</span>(
</span></span><span style="display:flex;"><span>            { <span style="color:#a6e22e">userId</span>, <span style="color:#a6e22e">email</span> }, <span style="color:#75715e">// for token payload
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">publicKey</span>, 
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">privateKey</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Store publicKey, privateKey and refreshToken with correct userId to DB
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">KeyTokenService</span>.<span style="color:#a6e22e">createKeyToken</span>({
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">userId</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">publicKey</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">privateKey</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">refreshToken</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tokens</span>.<span style="color:#a6e22e">refreshToken</span>,
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">user</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">foundUser</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">tokens</span>,
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">static</span> <span style="color:#a6e22e">handleRefreshToken</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> ({ <span style="color:#a6e22e">refreshToken</span>, <span style="color:#a6e22e">user</span>, <span style="color:#a6e22e">keyStore</span> }) =&gt; {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">userId</span>, <span style="color:#a6e22e">email</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">user</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">keyStore</span>.<span style="color:#a6e22e">refreshTokensUsed</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">refreshToken</span>)) {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">await</span> <span style="color:#a6e22e">KeyTokenService</span>.<span style="color:#a6e22e">removeByUserId</span>(<span style="color:#a6e22e">userId</span>);
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ForbiddenError</span>(<span style="color:#e6db74">&#34;Something wrong happen. Pls relogin&#34;</span>);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">keyStore</span>.<span style="color:#a6e22e">refreshToken</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">refreshToken</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">AuthFailureError</span>(<span style="color:#e6db74">&#34;Token is deleted or never exist&#34;</span>);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">foundUser</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">findByEmail</span>({ <span style="color:#a6e22e">email</span> });
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">foundUser</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">AuthFailureError</span>(<span style="color:#e6db74">&#34;User is deleted or never exist&#34;</span>);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tokens</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">createTokenPair</span>(
</span></span><span style="display:flex;"><span>			{ <span style="color:#a6e22e">userId</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">foundUser</span>.<span style="color:#a6e22e">_id</span>, <span style="color:#a6e22e">email</span> },
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">keyStore</span>.<span style="color:#a6e22e">publicKey</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">keyStore</span>.<span style="color:#a6e22e">privateKey</span>
</span></span><span style="display:flex;"><span>		);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">await</span> <span style="color:#a6e22e">keyStore</span>.<span style="color:#a6e22e">updateOne</span>({
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">$set</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">refreshToken</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tokens</span>.<span style="color:#a6e22e">refreshToken</span>,
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">$addToSet</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">refreshTokensUsed</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">refreshToken</span>,
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>		});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">user</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">tokens</span>,
</span></span><span style="display:flex;"><span>		};
</span></span><span style="display:flex;"><span>	};
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">AccessService</span>;
</span></span></code></pre></div>
  </div>
</details>

</br>
<details ><summary>routes.js</summary>
  <div class="markdown-inner">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">express</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;express&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">accessController</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;../../controllers/access.controller.js&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">authentication</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;../../auth/authUtils.js&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">router</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">express</span>.<span style="color:#a6e22e">Router</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">asyncHandler</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">fn</span>) =&gt; {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>) =&gt; {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fn</span>(<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>).<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">next</span>);
</span></span><span style="display:flex;"><span>	};
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#34;/user/login&#34;</span>, <span style="color:#a6e22e">asyncHandler</span>(<span style="color:#a6e22e">accessController</span>.<span style="color:#a6e22e">login</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Authenticate before using restricted resources
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">use</span>(<span style="color:#a6e22e">asyncHandler</span>(<span style="color:#a6e22e">authentication</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#34;/user/handleRefreshToken&#34;</span>, <span style="color:#a6e22e">asyncHandler</span>(<span style="color:#a6e22e">accessController</span>.<span style="color:#a6e22e">handleRefreshToken</span>));
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">asyncHandler</span>(<span style="color:#a6e22e">postController</span>.<span style="color:#a6e22e">createPost</span>));
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">patch</span>(<span style="color:#e6db74">&#34;/:postId&#34;</span>, <span style="color:#a6e22e">asyncHandler</span>(<span style="color:#a6e22e">postController</span>.<span style="color:#a6e22e">updatePost</span>));
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;/drafts/all&#34;</span>, <span style="color:#a6e22e">asyncHandler</span>(<span style="color:#a6e22e">postController</span>.<span style="color:#a6e22e">findAllDraftsOfUser</span>));
</span></span></code></pre></div>
  </div>
</details>

<h2 id="reference">
  Reference
  <a class="anchor" href="#reference">#</a>
</h2>
<ul>
<li>Geeksforgeeks: <a href="https://www.geeksforgeeks.org/access-token-vs-refresh-token-a-breakdown/">Access Token vs Refresh Token: A Breakdown</a> (27 Sep, 2024)</li>
<li>Medium: <a href="https://medium.com/@lakshyakumarsingh.2003.va/understanding-access-tokens-and-refresh-tokens-2ec4bc4f9a4f">Understanding Access Tokens and Refresh Tokens</a> (Mar 23, 2024)</li>
</ul>
<style>
    .feedback-card {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        max-width: 100%;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        background-color: #f9f9fb;
    }
    .feedback-card h2 {
        font-size: 20px;
        margin-top: 0px;
        margin-bottom: 10px;
    }
    .feedback-card .buttons {
        margin: 10px 0;
    }
    .feedback-card button {
        border: none;
        background-color: #f0f0f0;
        border-radius: 4px;
        padding: 10px 15px;
        margin-right: 10px;
        cursor: pointer;
        font-size: 16px;
    }
    .feedback-card button:hover {
        background-color: #e0e0e0;
    }
    .feedback-card a {
        color: #0074d9;
        text-decoration: none;
    }
    .feedback-card a:hover {
        text-decoration: underline;
    }
    .feedback-card p {
        font-size: 14px;
        color: #555;
    }

     
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 7px;
      padding-bottom: 50px;

      background-color: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: flex-end;
    }

    .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 5px;
      width: 300px;
    }

    .modal input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
    }
</style>
<div class="feedback-card" id="feedbackCard">
    <h2>Help improve my blog</h2>
    <p>Was this page helpful to you?</p>
    <div class="buttons">
        <button id="yesBtn">üëç Yes</button>
        <button id="noBtn">üëé No</button>
    </div>
    <p>This page was last modified at <strong>2025-01-03</strong></p>
    <ul>
        <li><a href="https://github.com/DangPham112000/blog" target="_blank">View this page on GitHub</a></li>
        <li><a href="#" class="link-button" id="linkButton">Report a problem with this content</a></li>
    </ul>
</div>

<div class="modal" id="formModal">
    <div class="feedback-card">
        <h2>Can I know your name?</h2>
        <form id="form">
            <input type="text" name="username" placeholder="Enter your name">
            <button type="submit">Yes</button>
            <button type="submit">No</button>
        </form>
    </div>
</div>

<script>
    const feedbackCardEle = document.getElementById("feedbackCard");
    const formModalEle = document.getElementById('formModal');
    const elesToShowForm = ['linkButton', 'yesBtn', 'noBtn'];

    for (const ele of elesToShowForm) {
        document.getElementById(ele).addEventListener('click', function(e) {
            e.preventDefault();
            formModalEle.style.display = 'flex';
        });
    }

    window.onclick = function(event) {
        if (event.target === formModalEle) {
            formModalEle.style.display = 'none';
        }
    };

    document.getElementById('form').addEventListener('submit', function(e) {
        e.preventDefault(); 
        alert('This feature is currently being developed');
        formModalEle.style.display = 'none'; 
    });
</script>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#access-token">Access token</a>
      <ul>
        <li><a href="#characteristics">Characteristics</a></li>
      </ul>
    </li>
    <li><a href="#refresh-token">Refresh token</a>
      <ul>
        <li><a href="#characteristics-1">Characteristics</a></li>
      </ul>
    </li>
    <li><a href="#how-do-they-work-together">How do they work together?</a>
      <ul>
        <li><a href="#basic-flow">Basic flow</a></li>
        <li><a href="#token-expired">Token expired</a></li>
        <li><a href="#threat-mitigation-strategy">Threat mitigation strategy</a></li>
        <li><a href="#third-party-authen-concept">Third party authen concept</a></li>
      </ul>
    </li>
    <li><a href="#demo-code">Demo code</a></li>
    <li><a href="#reference">Reference</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












